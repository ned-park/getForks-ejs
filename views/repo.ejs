<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>getForks - <%=usernamePage%>/<%=repo.title%></title>
    <link rel="icon" type="image/x-icon" href="/images/favicon.ico">
    <link rel="stylesheet" href="../css/style.css">
</head>
<body class="bg-white">
    <%- include('partials/header') -%>
    <section class="container m-auto mt-8">
        <div class="flex justify-between">
        <h2 class="font-bold text-xl"><a href="."><%=usernamePage%></a></h2>
        <section class="content-container flex flex-end" id="version-select">
            <label for="version">Choose a version:</label>
            <select name="version" id="version">
                <% for (let i = 0; i < repo.versions.length; i++) { 
                    let selected = ( version == i ) ? "selected" : "" 
                %>
                    <option value="<%=i%>" <%=selected%>><%=i%></option>
                <% } %>  
            </select>
        </section>
        </div>

    <section class="container flex flex-col recipe-body shadow" data-id="<%=repo._id%>" data-username="<%=usernamePage%>">
        <% if (user != null && user.username === usernamePage) {%>
            <div class="flex justify-between">
                <span class='del text-2xl font-bold' >&times;</span>
                <h1 class="font-bold text-3xl text-center" data-username="<%=usernamePage%>"><%=repo.versions[version].title%></h1>
                <span class='edit text-2xl font-bold'>&cup;</span>
            </div>
        <% } else if (user != null){ %>
            <div class="flex justify-end"></div>
                <form action="/<%=usernamePage%>/forkRepo" method="POST">
                    <input type="submit" value="&Psi;" class="text-2xl font-bold fork">
                    <input type="hidden" name="repoId" value="<%=repo._id%>">
                </form>
            </div>       
            <h1 class="font-bold text-3xl text-center" data-username="<%=usernamePage%>"><%=repo.versions[version].title%></h1>
            <!-- <span class='fork'>Fork</span> -->
        <% } %>
        
        <% if (repo.image) {
            let baseUrl = repo.image.slice(0,49), filename = repo.image.slice(62) 
        %>
        <img class="mt-4 self-center"
    	sizes="(min-width: 30em) 50em, 28em, 100vw"
    	srcset="<%=baseUrl%>/f_auto,q_70,w_256/<%=filename%> 256w,
    	        <%=baseUrl%>/f_auto,q_70,w_512/<%=filename%> 512w,
    	        <%=baseUrl%>/f_auto,q_70,w_768/<%=filename%> 768w,
    	        <%=baseUrl%>/f_auto,q_70,w_1024/<%=filename%> 1024w,
    	        <%=baseUrl%>/f_auto,q_70,w_1280/<%=filename%> 1280w"
    	src="%<=baseUrl%>/f_auto,q_70,w_512/%<=filename%>"
    	alt="User provided image of recipe" />

        <% } %>
        <p><%=repo.description%></p>
        <p>Notes: <%=repo.versions[version].notes%></p>
        <p>ingred: <%=repo.versions[version].ingredients%></p>
        <p>instr: <%=repo.versions[version].instructions%></p>

    </section>
    <!-- Make edit into modal possibly a drop-in partial view for it to avoid wet code? -->
    <section class="modal">
        <section class="content-container modal-content">
            <span class="close">&times;</span>
            <h2 class="center">Update Recipe: <%=repo.title%></h2>
            <form action="/<%=usernamePage%>/commitRecipe" method='POST' class="flex col">
                <input type="text" name="title" placeholder="Recipe Title" value="<%=repo.title%>">
                <input type="text" placeholder="Notes (optional)" value="<%=repo.versions[version].notes%>" name='notes'>
                <!-- <input type="text" placeholder="" value="<%=repo.description%>" name='description'> -->
                <input type="text" placeholder="Ingredients" value="<%=repo.versions[version].ingredients%>" name='ingredients'>
                <input type="text" placeholder="Instructions" value="<%=repo.versions[version].instructions%>" name='instructions'>
                <input type="hidden" name="repoId" value="<%=repo._id%>">
                <input type="submit" value="Update Recipe">
            </form>
        </section>
    </section>
    </section>
    <script src="../js/main.js"></script>
</body>
</html>